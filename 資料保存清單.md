# 系統資料保存清單

## 📊 資料保存總覽

系統目前可以保存以下資料類型，所有資料都會在瀏覽器刷新後保留。

---

## 🔐 權限管理模組（支援 GitHub Gist 同步）

### 1. **用戶資料** (`tsa_users_v1`)
- **儲存位置**：localStorage / GitHub Gist (`users.json`)
- **資料內容**：
  - 帳號 (account)
  - 密碼 (password) - 目前為明文，建議加密
  - 姓名 (name)
  - 電子郵件 (email)
  - 角色 ID (roleId)
  - 所屬會館 (hallName)
  - 允許存取的會館列表 (allowedHalls)
  - 啟用狀態 (isActive)
  - 建立/更新時間
  - 最後登入時間

### 2. **角色資料** (`tsa_roles_v1`)
- **儲存位置**：localStorage / GitHub Gist (`roles.json`)
- **資料內容**：
  - 角色 ID (id)
  - 角色名稱 (name)
  - 角色說明 (description)
  - 權限列表 (permissions) - 包含所有模組的操作權限
  - 是否為系統預設角色 (isSystem)
  - 建立/更新時間

### 3. **操作日誌** (`tsa_operation_logs_v1`)
- **儲存位置**：localStorage / GitHub Gist (`logs.json`)
- **資料內容**：
  - 操作者資訊（用戶ID、姓名、帳號）
  - 操作模組 (module)
  - 操作類型 (action)
  - 目標類型與ID (targetType, targetId)
  - 操作描述 (description)
  - 變更記錄 (changes) - 記錄欄位變更前後的值
  - IP 位址、User Agent
  - 操作時間
- **保留數量**：最近 1000 筆

---

## 🛠️ 工單管理模組

### 4. **工單資料** (`tsa_repair_orders_v6`)
- **儲存位置**：localStorage
- **資料內容**：
  - 工單 ID、類型（例行/志工報修）
  - 標題、描述
  - 會館名稱、區域
  - 類別（空調、機電、消防等）
  - 緊急程度、狀態
  - 報修人、負責人
  - 處理方式、處理描述
  - 簽呈狀態、送簽日期、簽呈檔案
  - 完工狀態、完工日期、照片
  - 付款狀態、付款日期、金額、廠商
  - 備註、AI 分析結果
  - 建立/更新時間、刪除標記

---

## 🏢 會館管理模組

### 5. **會館基本資料** (`tsa_halls_v3`)
- **儲存位置**：localStorage
- **資料內容**：
  - 會館 ID、名稱
  - 地址、區域、圈別
  - 興建日期
  - 電話資料（含統編）
  - 網路資料（含統編）
  - 會館照片
  - 電路配置圖 URL
  - 平面圖 URL

---

## 📦 設施管理模組

### 6. **設施資料** (`tsa_equipments_v1`)
- **儲存位置**：localStorage
- **資料內容**：
  - 設施 ID（自動生成批次序號）
  - 會館名稱、位置
  - 類別、品名、型號
  - 數量、購買日期、價格
  - 保固年限
  - 設施照片
  - 建立時間

### 7. **設施異動記錄** (`tsa_equip_changes_v1`)
- **儲存位置**：localStorage
- **資料內容**：
  - 異動 ID
  - 異動類型（移動位置/報廢）
  - 設施 ID
  - 異動日期
  - 原因說明
  - 提報人

---

## 💧 飲水機管理模組

### 8. **飲水機資料** (`tsa_water_dispensers_v3`)
- **儲存位置**：localStorage
- **資料內容**：
  - 飲水機 ID
  - 會館名稱、位置
  - 型號
  - 安裝日期
  - 保養週期
  - 濾芯狀態（各項濾芯更換日期）

### 9. **飲水機保養歷史** (`tsa_water_history_v3`)
- **儲存位置**：localStorage
- **資料內容**：
  - 保養記錄 ID
  - 飲水機 ID
  - 保養日期
  - 保養類型
  - 保養描述
  - 費用

---

## ❤️ AED 管理模組

### 10. **AED 資料** (`tsa_aeds_v16`)
- **儲存位置**：localStorage
- **資料內容**：
  - AED ID
  - 會館名稱、位置
  - 品牌、型號、序號
  - 購買日期
  - 電池到期日
  - 電極片到期日
  - 廠商資訊（名稱、電話）
  - 最後檢查日期
  - 歷史記錄（電池/電極片更換、檢查記錄）

---

## 🚗 公務車管理模組

### 11. **公務車資料** (`tsa_vehicles_v6`)
- **儲存位置**：localStorage
- **資料內容**：
  - 車輛 ID
  - 會館名稱
  - 品牌、型號、車牌號碼
  - 管理人
  - 里程數
  - 購買日期
  - 記錄列表（保養/事故/保險理賠）

---

## 📄 合約管理模組

### 12. **合約資料** (`tsa_contracts_v2`)
- **儲存位置**：localStorage
- **資料內容**：
  - 合約 ID
  - 類別（保全、空調、清潔等）
  - 廠商名稱
  - 會館名稱
  - 摘要
  - 開始/結束日期
  - 費用
  - 提報人
  - 備註、附件
  - 建立時間

---

## 🌪️ 災害回報模組

### 13. **災害回報資料** (`tsa_disaster_reports_v1`)
- **儲存位置**：localStorage
- **資料內容**：
  - 災害 ID
  - 災害名稱
  - 災害類型（地震、火災、颱風等）
  - 各會館受災狀態列表
    - 會館 ID、名稱
    - 安全狀態（安全/輕微受損/嚴重損壞/尚未回報）
    - 備註
  - 建立時間

---

## ⚙️ 系統設定資料

### 14. **登入 Token** (`tsa_auth_token`)
- **儲存位置**：localStorage
- **用途**：記錄登入狀態

### 15. **儲存設定** (`tsa_storage_type`, `tsa_gist_token`, `tsa_gist_id`)
- **儲存位置**：localStorage
- **用途**：
  - 儲存類型（local/gist）
  - GitHub Gist Token（如果使用 Gist 儲存）
  - Gist ID（如果使用 Gist 儲存）

---

## 📈 資料統計

| 模組 | 資料類型數 | 支援 Gist 同步 |
|------|-----------|---------------|
| 權限管理 | 3 | ✅ |
| 工單管理 | 1 | ❌ |
| 會館管理 | 1 | ❌ |
| 設施管理 | 2 | ❌ |
| 飲水機管理 | 2 | ❌ |
| AED 管理 | 1 | ❌ |
| 公務車管理 | 1 | ❌ |
| 合約管理 | 1 | ❌ |
| 災害回報 | 1 | ❌ |
| 系統設定 | 3 | ❌ |
| **總計** | **16** | **3** |

---

## 🔄 資料同步狀態

### ✅ 已整合到 storageService（支援 Gist）
- 用戶資料
- 角色資料
- 操作日誌

### ⚠️ 僅使用 localStorage（尚未整合）
- 工單資料
- 會館資料
- 設施資料
- 設施異動記錄
- 飲水機資料
- 飲水機保養歷史
- AED 資料
- 公務車資料
- 合約資料
- 災害回報資料

---

## 💡 建議

1. **擴展 Gist 支援**：可以將其他模組的資料也整合到 storageService，支援 Gist 同步
2. **資料備份**：定期匯出重要資料作為備份
3. **資料遷移**：提供資料匯入/匯出功能，方便在不同裝置間遷移
4. **資料清理**：提供清理舊資料的功能，避免儲存空間過大

---

## 📝 備註

- 所有資料版本號（如 `v1`, `v2`, `v6`）用於資料結構變更時的版本控制
- localStorage 有大小限制（約 5-10MB），建議定期清理舊資料
- 使用 GitHub Gist 儲存時，資料會以私有 Gist 形式儲存，只有擁有 Token 的使用者可以存取

