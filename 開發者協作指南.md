# 開發者協作指南

本指南幫助團隊成員快速上手專案開發，確保協作順暢。

## 📋 目錄

- [環境設置](#環境設置)
- [專案結構](#專案結構)
- [開發流程](#開發流程)
- [程式碼規範](#程式碼規範)
- [Git 工作流程](#git-工作流程)
- [測試與除錯](#測試與除錯)
- [常見問題](#常見問題)

---

## 環境設置

### 第一次設置

1. **克隆專案**
   ```bash
   git clone <repository-url>
   cd tsa-repair-system
   ```

2. **安裝依賴**
   ```bash
   npm install
   ```

3. **設置環境變數**
   - 創建 `.env.local` 文件
   - 添加 `GEMINI_API_KEY=your_api_key_here`
   - 注意：`.env.local` 不會被提交到 Git

4. **啟動開發伺服器**
   ```bash
   npm run dev
   ```

### 使用啟動腳本

- **macOS / Linux**：`./start.sh`
- **Windows (CMD)**：`start.bat`
- **Windows (PowerShell)**：`.\start.ps1`

詳細說明請參考 [本地運行指南.md](./本地運行指南.md)

---

## 專案結構

```
tsa-repair-system/
├── components/          # React 組件
│   ├── Dashboard.tsx   # 儀表板
│   ├── Login.tsx      # 登入頁面
│   ├── NewRequestForm.tsx  # 新增工單表單
│   ├── RequestList.tsx     # 工單列表
│   ├── RequestDetail.tsx   # 工單詳情
│   ├── WorkReportForm.tsx # 工作報告表單
│   ├── MobileSimulation.tsx # 手機模擬介面
│   └── ...            # 其他功能組件
├── services/          # API 服務
│   └── geminiService.ts  # Gemini AI 服務
├── types.ts           # TypeScript 類型定義
├── constants.tsx      # 常數配置（會館、類別等）
├── App.tsx           # 主應用組件
├── index.tsx         # 應用入口
├── vite.config.ts    # Vite 配置
├── tsconfig.json     # TypeScript 配置
└── package.json      # 專案依賴與腳本
```

### 重要文件說明

- **`types.ts`**：定義所有 TypeScript 類型，新增功能時請先在此定義類型
- **`constants.tsx`**：存放會館列表、類別等常數資料
- **`App.tsx`**：主應用邏輯，路由與狀態管理
- **`vite.config.ts`**：構建配置，包含環境變數注入

---

## 開發流程

### 1. 創建功能分支

```bash
git checkout -b feature/your-feature-name
```

分支命名規範：
- `feature/` - 新功能
- `fix/` - 錯誤修復
- `refactor/` - 重構
- `docs/` - 文檔更新

### 2. 開發新功能

1. **定義類型**（在 `types.ts`）
2. **創建組件**（在 `components/`）
3. **添加服務**（如需要，在 `services/`）
4. **整合到主應用**（在 `App.tsx`）

### 3. 測試功能

- 在開發伺服器中測試
- 檢查瀏覽器控制台是否有錯誤
- 測試不同瀏覽器（Chrome、Firefox、Safari、Edge）

### 4. 提交變更

```bash
git add .
git commit -m "feat: 添加新功能描述"
```

提交訊息規範：
- `feat:` - 新功能
- `fix:` - 修復錯誤
- `docs:` - 文檔更新
- `style:` - 程式碼格式調整
- `refactor:` - 重構
- `test:` - 測試相關
- `chore:` - 構建過程或輔助工具的變動

### 5. 推送並創建 Pull Request

```bash
git push origin feature/your-feature-name
```

然後在 GitHub 上創建 Pull Request。

---

## 程式碼規範

### TypeScript

- 使用 TypeScript 嚴格模式
- 為所有函數參數和返回值定義類型
- 避免使用 `any`，優先使用具體類型或 `unknown`

### React 組件

- 使用函數式組件和 Hooks
- 組件名稱使用 PascalCase
- Props 使用 TypeScript 介面定義
- 使用 `useState` 時，優先使用函數式更新：

```typescript
// ✅ 正確：使用函數式更新
setFormData(prev => ({...prev, field: value}))

// ❌ 錯誤：直接使用舊狀態
setFormData({...formData, field: value})
```

### 樣式

- 使用 Tailwind CSS 類別
- 保持一致的間距和顏色
- 響應式設計優先

### 命名規範

- **組件**：PascalCase（`NewRequestForm.tsx`）
- **函數/變數**：camelCase（`handleSubmit`）
- **常數**：UPPER_SNAKE_CASE（`MOCK_HALLS`）
- **類型/介面**：PascalCase（`RepairRequest`）

---

## Git 工作流程

### 主分支策略

- `main` - 生產環境分支，保持穩定
- `develop` - 開發分支（如果有的話）

### 協作流程

1. **拉取最新變更**
   ```bash
   git checkout main
   git pull origin main
   ```

2. **創建功能分支**
   ```bash
   git checkout -b feature/your-feature
   ```

3. **開發與提交**
   ```bash
   # 開發...
   git add .
   git commit -m "feat: 功能描述"
   ```

4. **推送分支**
   ```bash
   git push origin feature/your-feature
   ```

5. **創建 Pull Request**
   - 在 GitHub 上創建 PR
   - 填寫清晰的描述
   - 請求其他開發者審查

6. **合併後清理**
   ```bash
   git checkout main
   git pull origin main
   git branch -d feature/your-feature
   ```

### 解決衝突

如果遇到合併衝突：

```bash
git checkout main
git pull origin main
git checkout feature/your-feature
git merge main
# 解決衝突後
git add .
git commit -m "fix: 解決合併衝突"
```

---

## 測試與除錯

### 開發工具

- **React DevTools**：Chrome/Firefox 擴充功能
- **瀏覽器開發者工具**：檢查 Console、Network、Elements

### 常見除錯技巧

1. **檢查控制台錯誤**
   - 打開瀏覽器開發者工具（F12）
   - 查看 Console 標籤頁

2. **檢查網路請求**
   - 查看 Network 標籤頁
   - 確認 API 請求是否成功

3. **使用 React DevTools**
   - 檢查組件狀態
   - 追蹤 Props 變化

4. **檢查 TypeScript 錯誤**
   ```bash
   # 檢查類型錯誤
   npx tsc --noEmit
   ```

### 測試清單

開發新功能時，請測試：

- [ ] 功能正常運作
- [ ] 無控制台錯誤
- [ ] 響應式設計正常（手機、平板、桌面）
- [ ] 表單驗證正常
- [ ] 錯誤處理完善
- [ ] 載入狀態正確顯示

---

## 常見問題

### Q: 無法連續輸入文字

**A:** 這是因為狀態更新使用了舊值。請使用函數式更新：

```typescript
// ✅ 正確
onChange={e => setFormData(prev => ({...prev, field: e.target.value}))}

// ❌ 錯誤
onChange={e => setFormData({...formData, field: e.target.value})}
```

### Q: 依賴安裝失敗

**A:** 
```bash
# 清除快取並重新安裝
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

### Q: 端口 3000 已被占用

**A:** 修改 `vite.config.ts` 中的 `server.port` 為其他端口。

### Q: 構建失敗

**A:** 
1. 檢查 Node.js 版本（需要 18+）
2. 清除 `node_modules` 和 `package-lock.json` 後重新安裝
3. 檢查 TypeScript 錯誤：`npx tsc --noEmit`

### Q: 環境變數不生效

**A:** 
1. 確認文件命名為 `.env.local`（注意前面的點）
2. 重新啟動開發伺服器
3. 檢查變數名稱是否正確（`GEMINI_API_KEY`）

---

## 資源連結

- [React 官方文檔](https://react.dev/)
- [TypeScript 手冊](https://www.typescriptlang.org/docs/)
- [Tailwind CSS 文檔](https://tailwindcss.com/docs)
- [Vite 文檔](https://vitejs.dev/)
- [本地運行指南](./本地運行指南.md)

---

## 聯絡與支援

如有問題或需要協助，請：
1. 查看 [本地運行指南.md](./本地運行指南.md)
2. 檢查 [常見問題](#常見問題)
3. 聯繫團隊成員
4. 在 GitHub 上創建 Issue

祝開發順利！🚀

